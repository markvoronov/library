# library

REST API на Go для управления коллекцией книг и авторами,
которые их пишут

## Описание проекта

Настройки работы http сервера и базы данных описаны в файле config/local.yaml
По умолчанию, на локальной машине проброшены следующие порты:

    http сервер - 8087
    база данных postgres - 5437 



Проект состоит из 3 слоев логики: 

     - обработчики http запросов
     - Уровень бизнес-логики
     - Уровень работы с базой данных

http обработчики: internal/http-server/handlers
На этом уровне реализована проверка валидности запросов, парсинг полученных JSON 
в структуры данных проекта (описанны в library.go)

Сервисные обработчики (уровень бизнес логики): internal/service. Выполняют необходимые проверки
перед выполнением запроса. Например, проверяют корректность переданной даты рождения автора
Проверяют существование объектов базы данных перед их удалением

Обработчики работы с базой данных: internal/storage. В этом пакете задекларирован интерфейс
работы с методами базы данных. Конкретные реализации располагаются на уровень ниже. В данном 
прокте реализована логика работы с postgreSQL, но легко могут быть добавлены и другие пакеты, 
имплементирующие описанные интерфейсы.

Файлы базы данных будут хранится в диретории data проекта.


## Инструкции по сборке и запуску

Инструкции описаны в `Makefile`, их так же можно запустить вручную

Шаги для запуска:
### Сборка контейнера
```sh
docker-compose build library_app (или make build )
 ```
### Запуск контейнера
```sh
docker-compose up library_app (make run)
 ```
### Миграция схемы базы данных
После предыдущих шагов в Docker должны появится 2 контейнера.
Миграция схемы базы не предусмотрена в автоматическом режиме, поскольку есть смысл выполнять
ее только один раз в начала работы приложения.
Для миграции нужно выполнить команду
 ```sh
migrate -path ./schema -database 'postgres://postgres:qwerty@localhost:5432/postgres?sslmode=disable' up
 ```
в makefile она описана командой 
 ```sh
make migrate
 ```


## Спецификация API
Для книг:

• POST/books — Добавить новую книгу;

• GET /books — Получить все книги;

• GET /books/{id} — Получить книгу по ее идентификатору;

• PUT /books/{id} — обновить книгу по ее идентификатору;

• DELETE /books/{id} — Удалить книгу по ее идентификатору.

Для авторов:

• POST/authors — Добавить нового автора;

• GET /authors — Получить всех авторов;

• GET /authors/{id} — получить автора по его идентификатору;

• PUT /authors/{id} — обновить автора по его идентификатору;

• DELETE /authors/{id} — удалить автора по его идентификатору.

Транзакционное обновление:

• PUT /book/{book_id}/authors/{author_id} — одновременно обновить сведения
о книге и авторе

### Проверка работоспособности
Примеры использования API, примеры JSON описаны в файле
Примеры использования API.md